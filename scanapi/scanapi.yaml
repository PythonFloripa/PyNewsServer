endpoints:
  - name: py_news_server
    path: ${BASE_URL}/api
    vars:
      community_username: ${USERNAME_TEST}
      community_password: ${PASSWORD_TEST}
    requests:
      - name: healthcheck
        path: healthcheck
        tests:
          - !include tests/status_code_is_200.yaml
          - !include tests/healthcheck/body_status_healthy.yaml
      - name: create_community
        path: authentication/create_community
        method: POST
        body:
          name: "Test Community"
      - name: login_for_access_token
        path: authentication/token
        method: POST
        headers:
          Content-Type: application/x-www-form-urlencoded
        body:
          username: ${community_username}
          password: ${community_password}
        tests:
          - !include tests/status_code_is_200.yaml
        vars:
          access_token: ${{ response.json()["access_token"] }}
    endpoints:
      - !include libraries_authenticated.yaml
      - !include libraries_unauthenticated.yaml
      - !include news_authenticated.yaml
      - !include news_unauthenticated.yaml
